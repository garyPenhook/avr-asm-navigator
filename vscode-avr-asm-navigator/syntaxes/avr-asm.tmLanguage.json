{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "AVR Assembly",
  "scopeName": "source.avr-asm",
  "patterns": [
    {
      "include": "#preprocessor"
    },
    {
      "include": "#strings"
    },
    {
      "include": "#comments"
    },
    {
      "include": "#labels"
    },
    {
      "include": "#directives"
    },
    {
      "include": "#registers"
    },
    {
      "include": "#instructions"
    },
    {
      "include": "#builtinFunctions"
    },
    {
      "include": "#operators"
    },
    {
      "include": "#numbers"
    }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.semicolon.avr-asm",
          "match": ";.*$"
        },
        {
          "name": "comment.line.double-slash.avr-asm",
          "match": "//.*$"
        },
        {
          "name": "comment.block.c.avr-asm",
          "begin": "/\\*",
          "end": "\\*/"
        }
      ]
    },
    "preprocessor": {
      "patterns": [
        {
          "name": "meta.preprocessor.avr-asm",
          "begin": "^\\s*#\\s*(include|define|undef|if|ifdef|ifndef|elif|else|endif|error|warning|pragma|line)\\b",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.preprocessor.avr-asm"
            }
          },
          "end": "$",
          "patterns": [
            {
              "include": "#strings"
            },
            {
              "include": "#numbers"
            }
          ]
        }
      ]
    },
    "labels": {
      "patterns": [
        {
          "name": "entity.name.label.avr-asm",
          "match": "^\\s*([A-Za-z_.$][A-Za-z0-9_.$]*)\\s*:"
        },
        {
          "name": "entity.name.label.local.numeric.avr-asm",
          "match": "^\\s*(\\d+)\\s*:"
        }
      ]
    },
    "directives": {
      "patterns": [
        {
          "name": "keyword.control.directive.avr-asm",
          "match": "(?i)\\.(?:align|ascii|asciz|balign|bss|byte|cseg|data|def|device|dseg|else|elseif|endfunc|endif|endm|endr|equ|equiv|eseg|extern|file|fill|func|global|globl|if|ifb|ifc|ifdef|ifeq|ifge|ifgt|ifle|iflt|ifnb|ifnc|ifndef|ifne|incbin|include|irp|irpc|lcomm|line|list|long|macro|nolist|org|p2align|popsection|pushsection|quad|rept|section|set|size|skip|space|string|subsection|text|type|weak|word|zero)\\b"
        },
        {
          "name": "meta.definition.constant.avr-asm",
          "match": "(?i)^\\s*\\.(equ|equiv|set|def)\\s+([A-Za-z_.$][A-Za-z0-9_.$]*)\\b",
          "captures": {
            "1": {
              "name": "keyword.control.directive.avr-asm"
            },
            "2": {
              "name": "entity.name.constant.avr-asm"
            }
          }
        }
      ]
    },
    "registers": {
      "patterns": [
        {
          "name": "variable.language.register.avr-asm",
          "match": "(?i)\\b(?:r(?:[0-9]|[1-2][0-9]|3[0-1])|x|y|z|xl|xh|yl|yh|zl|zh)\\b"
        }
      ]
    },
    "instructions": {
      "patterns": [
        {
          "name": "keyword.other.instruction.avr-asm",
          "match": "(?i)\\b(?:adc|add|adiw|and|andi|asr|bclr|bld|brbc|brbs|brcc|brcs|break|breq|brge|brhc|brhs|brid|brie|brlo|brlt|brmi|brne|brpl|brsh|brtc|brts|brvc|brvs|bset|bst|call|cbi|cbr|clc|clh|cli|cln|clr|cls|clt|clv|clz|com|cp|cpc|cpi|cpse|dec|des|eicall|eijmp|elpm|eor|fmul|fmuls|fmulsu|icall|ijmp|in|inc|jmp|lac|las|lat|ld|ldd|ldi|lds|lpm|lsl|lsr|mov|movw|mul|muls|mulsu|neg|nop|or|ori|out|pop|push|rcall|ret|reti|rjmp|rol|ror|sbc|sbci|sbi|sbic|sbis|sbiw|sbr|sbrc|sbrs|sec|seh|sei|sen|ser|ses|set|sev|sez|sleep|spm|st|std|sts|sub|subi|swap|tst|wdr|xch)\\b"
        }
      ]
    },
    "builtinFunctions": {
      "patterns": [
        {
          "name": "support.function.builtin.avr-asm",
          "match": "(?i)\\b(?:lo8|hi8|hh8|hlo8|hhi8|pm|gs)\\s*(?=\\()"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.arithmetic.avr-asm",
          "match": "<<|>>|[-+*/%&|^~!]"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.local-label-ref.avr-asm",
          "match": "\\b\\d+[fFbB]\\b"
        },
        {
          "name": "constant.numeric.hex.avr-asm",
          "match": "\\b0x[0-9A-Fa-f]+\\b"
        },
        {
          "name": "constant.numeric.binary.avr-asm",
          "match": "\\b0b[01]+\\b"
        },
        {
          "name": "constant.numeric.decimal.avr-asm",
          "match": "(?<![A-Za-z0-9_.$])-?\\d+\\b"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.avr-asm",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.avr-asm",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.single.avr-asm",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.avr-asm",
              "match": "\\\\."
            }
          ]
        }
      ]
    }
  }
}
